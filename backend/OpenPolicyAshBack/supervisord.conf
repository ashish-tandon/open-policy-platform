[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
loglevel=info

[program:postgresql]
command=su - postgres -c "pg_ctl -D /var/lib/postgresql/data -l /var/log/postgresql/postgresql.log start"
autostart=true
autorestart=true
startretries=3
priority=100
stdout_logfile=/var/log/supervisor/postgresql.log
stderr_logfile=/var/log/supervisor/postgresql_error.log

[program:redis]
command=redis-server
autostart=true
autorestart=true
startretries=3
priority=200
stdout_logfile=/var/log/supervisor/redis.log
stderr_logfile=/var/log/supervisor/redis_error.log

[program:api]
command=uvicorn src.api.main:app --host 0.0.0.0 --port 8000 --workers 1
directory=/app
autostart=true
autorestart=true
startretries=3
priority=300
stdout_logfile=/var/log/supervisor/api.log
stderr_logfile=/var/log/supervisor/api_error.log
environment=PYTHONPATH="/app"
startsecs=10

[program:worker]
command=celery -A src.scheduler.tasks worker --loglevel=info --concurrency=2
directory=/app
autostart=true
autorestart=true
startretries=3
priority=400
stdout_logfile=/var/log/supervisor/worker.log
stderr_logfile=/var/log/supervisor/worker_error.log
environment=PYTHONPATH="/app"
startsecs=5

[program:beat]
command=celery -A src.scheduler.tasks beat --loglevel=info
directory=/app
autostart=true
autorestart=true
startretries=3
priority=500
stdout_logfile=/var/log/supervisor/beat.log
stderr_logfile=/var/log/supervisor/beat_error.log
environment=PYTHONPATH="/app"
startsecs=5

[program:flower]
command=celery -A src.scheduler.tasks flower --port=5555 --address=0.0.0.0
directory=/app
autostart=true
autorestart=true
startretries=3
priority=600
stdout_logfile=/var/log/supervisor/flower.log
stderr_logfile=/var/log/supervisor/flower_error.log
environment=PYTHONPATH="/app"
startsecs=5

[program:dashboard]
command=npm start
directory=/app/dashboard
autostart=true
autorestart=true
startretries=3
priority=700
stdout_logfile=/var/log/supervisor/dashboard.log
stderr_logfile=/var/log/supervisor/dashboard_error.log
environment=NODE_ENV="production"
startsecs=10

[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true
startretries=3
priority=800
stdout_logfile=/var/log/supervisor/nginx.log
stderr_logfile=/var/log/supervisor/nginx_error.log
startsecs=5

[eventlistener:processes]
command=bash -c "printf 'READY\n'; while read line; do printf 'RESULT 2\nOK'; printf 'READY\n'; done"
events=PROCESS_STATE_STOPPED,PROCESS_STATE_EXITED,PROCESS_STATE_FATAL 
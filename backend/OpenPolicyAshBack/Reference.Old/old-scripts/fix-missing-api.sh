#!/bin/bash

echo "üîß Fixing Missing OpenPolicy API Container"
echo "========================================="

QNAP_HOST="192.168.2.152"
QNAP_USER="ashish101"

echo "üìã Current Status Analysis:"
echo "=========================="
echo "‚úÖ Dashboard: Working (Port 3000)"
echo "‚úÖ Flower Monitor: Working (Port 5555)"
echo "‚ùå API: Missing (Port 8000)"
echo "‚ùå Database: Not responding properly"
echo "‚ùå Redis: Not responding properly"

echo ""
echo "üîç Issue Identified:"
echo "==================="
echo "The openpolicy_api container is missing from Container Station."
echo "This is why the API is not responding on port 8000."

echo ""
echo "üöÄ Solution: Add Missing API Container"
echo "====================================="
echo ""
echo "Please follow these steps in Container Station:"
echo ""
echo "1. Open Container Station: http://192.168.2.152:8080"
echo ""
echo "2. Click 'Create' ‚Üí 'Application'"
echo ""
echo "3. Search for: ashishtandon9/openpolicyashback:latest"
echo ""
echo "4. Configure the API container:"
echo "   - Container name: openpolicy_api"
echo "   - Port mapping: 8000:8000"
echo "   - Environment variables:"
echo "     DB_HOST=openpolicy_postgres"
echo "     DB_PORT=5432"
echo "     DB_NAME=opencivicdata"
echo "     DB_USER=openpolicy"
echo "     DB_PASSWORD=openpolicy123"
echo "     REDIS_URL=redis://openpolicy_redis:6379/0"
echo "     CORS_ORIGINS=http://192.168.2.152:3000,http://localhost:3000"
echo ""
echo "5. Volume mappings:"
echo "     /share/Container/openpolicy/regions_report.json:/app/regions_report.json:ro"
echo "     /share/Container/openpolicy/scrapers:/app/scrapers:ro"
echo ""
echo "6. Click 'Create'"
echo ""
echo "7. Start the container"
echo ""

echo "üìä Expected Timeline After Fix:"
echo "=============================="
echo "‚Ä¢ API container startup: 2-3 minutes"
echo "‚Ä¢ Database connection: 1-2 minutes"
echo "‚Ä¢ Health check response: 30 seconds"
echo "‚Ä¢ Full system operational: 5 minutes"
echo "‚Ä¢ First data scraping: 15-30 minutes"
echo "‚Ä¢ Complete data collection: 2-4 hours"

echo ""
echo "üåê URLs to Test After Fix:"
echo "========================="
echo "‚Ä¢ API Health: http://192.168.2.152:8000/health"
echo "‚Ä¢ API Docs: http://192.168.2.152:8000/docs"
echo "‚Ä¢ Dashboard: http://192.168.2.152:3000"
echo "‚Ä¢ Flower Monitor: http://192.168.2.152:5555"

echo ""
echo "‚úÖ Once the API container is added and running,"
echo "   your OpenPolicy system will be fully operational!" 